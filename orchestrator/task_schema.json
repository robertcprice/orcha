{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Autonomous Agent Task",
  "description": "Schema for automated task files in the agent queue system",
  "type": "object",
  "required": ["task_id", "title", "description", "priority", "created_at"],
  "properties": {
    "task_id": {
      "type": "string",
      "description": "Unique task identifier (UUID format)",
      "pattern": "^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$"
    },
    "title": {
      "type": "string",
      "description": "Short, descriptive task title",
      "minLength": 1,
      "maxLength": 200
    },
    "description": {
      "type": "string",
      "description": "Detailed task description with requirements and context"
    },
    "priority": {
      "type": "string",
      "enum": ["critical", "high", "normal", "low"],
      "description": "Task priority level (affects queue ordering)"
    },
    "created_at": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when task was created"
    },
    "created_by": {
      "type": "string",
      "description": "Source that created the task (e.g., 'web-app', 'terminal', 'agent:PP')"
    },
    "context": {
      "type": "object",
      "description": "Additional context for the task",
      "properties": {
        "project": {
          "type": "string",
          "description": "Project or module this task relates to"
        },
        "files": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Relevant file paths"
        },
        "dependencies": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Task IDs this task depends on"
        },
        "custom": {
          "type": "object",
          "description": "Custom context fields"
        }
      }
    },
    "config": {
      "type": "object",
      "description": "Task execution configuration",
      "properties": {
        "max_dialogue_turns": {
          "type": "integer",
          "minimum": 1,
          "maximum": 50,
          "default": 20,
          "description": "Maximum orchestrator dialogue turns"
        },
        "timeout_minutes": {
          "type": "integer",
          "minimum": 1,
          "maximum": 1440,
          "default": 60,
          "description": "Maximum task execution time in minutes"
        },
        "gpt_model": {
          "type": "string",
          "default": "gpt-4",
          "description": "GPT model for planning"
        },
        "allow_sub_agents": {
          "type": "boolean",
          "default": true,
          "description": "Allow agents to spawn sub-agents"
        },
        "max_agent_depth": {
          "type": "integer",
          "minimum": 1,
          "maximum": 5,
          "default": 3,
          "description": "Maximum sub-agent nesting depth"
        }
      }
    },
    "status": {
      "type": "string",
      "enum": ["pending", "active", "completed", "failed", "cancelled"],
      "description": "Current task status"
    },
    "assigned_to": {
      "type": "string",
      "description": "Orchestrator or agent currently handling the task"
    },
    "started_at": {
      "type": "string",
      "format": "date-time",
      "description": "When task execution started"
    },
    "completed_at": {
      "type": "string",
      "format": "date-time",
      "description": "When task execution finished"
    },
    "result": {
      "type": "object",
      "description": "Task execution results",
      "properties": {
        "status": {
          "type": "string",
          "enum": ["success", "partial", "failure"]
        },
        "summary": {
          "type": "string",
          "description": "Summary of work completed"
        },
        "artifacts": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Files created or modified"
        },
        "metrics": {
          "type": "object",
          "properties": {
            "dialogue_turns": {"type": "integer"},
            "execution_time_seconds": {"type": "number"},
            "agents_spawned": {"type": "integer"}
          }
        },
        "error": {
          "type": "string",
          "description": "Error message if task failed"
        }
      }
    }
  }
}
